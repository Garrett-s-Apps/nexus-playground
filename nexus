#!/usr/bin/env python3
"""
NEXUS - Unified code and repository analysis toolkit

A comprehensive suite of tools for understanding code quality, complexity,
and development patterns. All analysis tools in one place.

Usage:
  nexus analyze [--dir DIR] [--file FILE] [--json] [--no-color]
  nexus stats [--repo REPO] [--json] [--no-color]
  nexus --version
  nexus --help
"""

import sys
import subprocess
import argparse
from pathlib import Path


TOOLS_DIR = Path(__file__).parent


def run_tool(tool_name, args):
    """Run a tool by name with given arguments"""
    if tool_name == 'analyze':
        tool_path = TOOLS_DIR / 'complexity-analyzer' / 'analyzer.py'
    elif tool_name == 'stats':
        tool_path = TOOLS_DIR / 'codestats' / 'stats.py'
    else:
        print(f"Unknown tool: {tool_name}", file=sys.stderr)
        sys.exit(1)
    
    if not tool_path.exists():
        print(f"Tool not found: {tool_path}", file=sys.stderr)
        sys.exit(1)
    
    # Run the tool
    try:
        result = subprocess.run(
            [sys.executable, str(tool_path)] + args,
            cwd=TOOLS_DIR
        )
        sys.exit(result.returncode)
    except KeyboardInterrupt:
        print("\nInterrupted", file=sys.stderr)
        sys.exit(1)
    except Exception as e:
        print(f"Error running tool: {e}", file=sys.stderr)
        sys.exit(1)


def print_version():
    """Print version information"""
    print("NEXUS v1.0.0")
    print("Unified code and repository analysis toolkit")


def print_help():
    """Print help information"""
    help_text = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           NEXUS v1.0.0                                       â•‘
â•‘           Unified Code and Repository Analysis Toolkit                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

USAGE:
  nexus COMMAND [OPTIONS]

COMMANDS:
  analyze          Analyze code complexity and quality metrics
  stats            Analyze git repository statistics
  --help, -h       Show this help message
  --version        Show version information

EXAMPLES:

  # Analyze code complexity in current directory
  nexus analyze

  # Analyze a specific Python file
  nexus analyze --file mycode.py

  # Analyze a specific directory
  nexus analyze --dir /path/to/code

  # Analyze git repository
  nexus stats

  # Analyze a specific repository
  nexus stats --repo /path/to/repo

  # Export analysis as JSON
  nexus analyze --json > complexity.json
  nexus stats --json > repo-stats.json

  # Disable colored output
  nexus analyze --no-color
  nexus stats --no-color

TOOLS:

  ðŸ“Š ANALYZE (Code Complexity Analyzer)
    Analyzes Python code for cyclomatic complexity, code metrics,
    and quality indicators. Helps identify complex functions,
    understand code organization, and prioritize refactoring.

  ðŸ“ˆ STATS (CodeStats - Repository Analysis)
    Analyzes git history for contributor activity, development
    patterns, commit frequency, and code change metrics.

COMBINED WORKFLOWS:

  # Get complete project snapshot
  nexus analyze --json > /tmp/complexity.json
  nexus stats --json > /tmp/repo-stats.json

  # Share analysis results
  nexus analyze --no-color | tee complexity-report.txt
  nexus stats --no-color | tee activity-report.txt

  # For CI/CD pipelines
  nexus analyze --json | jq 'map(select(.max_complexity > 15))'
  nexus stats --json | jq '.top_authors[0]'

DOCUMENTATION:

  For detailed documentation on each tool, see:
  - complexity-analyzer/README.md  (Code analysis)
  - codestats/README.md            (Git analysis)
  - Main README.md                 (Overview)

VERSION: 1.0.0
LICENSE: MIT
"""
    print(help_text)


def main():
    """Main entry point"""
    if len(sys.argv) < 2:
        print_help()
        sys.exit(0)
    
    # Check for version or help
    if sys.argv[1] in ('--version', '-v'):
        print_version()
        sys.exit(0)
    
    if sys.argv[1] in ('--help', '-h', 'help'):
        print_help()
        sys.exit(0)
    
    # Route to tool
    tool_name = sys.argv[1]
    tool_args = sys.argv[2:]
    
    if tool_name in ('analyze', 'stats'):
        run_tool(tool_name, tool_args)
    else:
        print(f"Unknown command: {tool_name}", file=sys.stderr)
        print("Run 'nexus --help' for usage information", file=sys.stderr)
        sys.exit(1)


if __name__ == '__main__':
    main()
