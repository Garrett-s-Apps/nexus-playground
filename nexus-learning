#!/usr/bin/env python3
"""
NEXUS Learning - Decision outcome tracking and learning from experience

Integrated with NEXUS toolkit to activate the learning loop.

Usage:
  nexus-learning record              Record a decision outcome interactively
  nexus-learning report              Show comprehensive learning report
  nexus-learning show                Show outcomes for a specific decision
  nexus-learning export              Export learning data as JSON
  nexus-learning --help              Show this help
  nexus-learning --version           Show version
"""

import sys
import subprocess
from pathlib import Path


TOOLS_DIR = Path(__file__).parent


def main():
    """Main entry point"""
    if len(sys.argv) < 2:
        print_help()
        sys.exit(0)
    
    if sys.argv[1] in ('--version', '-v'):
        print("NEXUS Learning v1.0.0 (integrated with Decision Synthesizer)")
        sys.exit(0)
    
    if sys.argv[1] in ('--help', '-h', 'help'):
        print_help()
        sys.exit(0)
    
    # Route to learning CLI
    command = sys.argv[1]
    args = sys.argv[2:]
    
    learning_cli = TOOLS_DIR / 'decision-learning' / 'cli.py'
    
    if command in ('record', 'report', 'show', 'export'):
        try:
            result = subprocess.run(
                [sys.executable, str(learning_cli), command] + args,
                cwd=TOOLS_DIR
            )
            sys.exit(result.returncode)
        except KeyboardInterrupt:
            print("\nInterrupted", file=sys.stderr)
            sys.exit(1)
        except Exception as e:
            print(f"Error: {e}", file=sys.stderr)
            sys.exit(1)
    else:
        print(f"Unknown command: {command}", file=sys.stderr)
        print("Run 'nexus-learning --help' for usage", file=sys.stderr)
        sys.exit(1)


def print_help():
    """Print help information"""
    help_text = """
╔══════════════════════════════════════════════════════════════════════════════╗
║                    NEXUS LEARNING v1.0.0                                     ║
║            Decision Outcome Tracking & Learning System                       ║
║          (Integrated with Decision Synthesizer & NEXUS toolkit)              ║
╚══════════════════════════════════════════════════════════════════════════════╝

OVERVIEW:

  The Decision Synthesizer tells you to SYNTHESIZE rather than choose.
  NEXUS Learning measures whether that actually works.

  Workflow:
    1. Make a decision with: nexus decide "question?"
    2. Apply the synthesis approach in practice
    3. Record what actually happened: nexus-learning record
    4. Analyze patterns: nexus-learning report
    5. Let the system learn from experience

USAGE:

  nexus-learning COMMAND [OPTIONS]

COMMANDS:

  record     Record an outcome for a decision interactively
             Guides you through rating, timing, and learnings

  report     Show comprehensive learning report
             Statistics, patterns, and insights from all outcomes

  show       Show all outcomes for a specific decision
             See the history of a particular decision's results

  export     Export all learning data as JSON
             Saved to .decisions/learning_export.json

  --help     Show this help message
  --version  Show version information

EXAMPLES:

  # Record an outcome from a decision you made
  nexus-learning record

  # View your learning report
  nexus-learning report

  # See all outcomes for a specific decision
  nexus-learning show

  # Export data for analysis
  nexus-learning export

TYPICAL WORKFLOW:

  1. You face a choice:
     $ nexus decide "Should we refactor or build features?"
     
     (System suggests synthesis approach)

  2. You apply it in practice
     (Days or weeks of actual work)

  3. You record what happened:
     $ nexus-learning record
     
     (Interactive guide walks you through it)
     
     - Which decision? (picks from history)
     - What approach did we take?
     - What was the actual outcome?
     - Success rating (1-5)
     - How long to judge? (immediate/weeks/months)
     - Anything surprising?
     - What did we learn?
     - Would we do it again?

  4. You review your learning:
     $ nexus-learning report
     
     (See: success statistics, patterns, surprising outcomes)

  5. System learns patterns:
     (Which synthesis types work well)
     (What decisions tend to succeed)
     (What surprised you)

WHAT GETS TRACKED:

  For each outcome:
  • Decision question
  • Approach we took
  • Actual outcome
  • Success rating (1-5)
  • Timing (immediate/short_term/medium_term/long_term)
  • Whether it was surprising
  • What we learned
  • Whether we'd choose again
  • Timestamp

ANALYTICS PROVIDED:

  Success Statistics
  - Average rating across all outcomes
  - Distribution (how many 5's vs 1's?)
  - Would-choose-again percentage

  Patterns
  - Which decision types work best?
  - Most common outcomes
  - Success trends over time

  Surprises
  - Outcomes that were unexpected
  - Learning captured at the moment
  - Insight opportunities

  Insights
  - Are decisions improving?
  - Which synthesis approaches work?
  - Recommendations for improvement

WHY THIS MATTERS:

  The Integration Principle recommends synthesis instead of choosing.
  But how do you know if it works?

  This tool provides empirical evidence:
  - Does synthesis actually produce better outcomes?
  - Which synthesis types work best?
  - Are you improving over time?
  - What's actually working for your decisions?

DATA STORAGE:

  Outcomes are stored in: .decisions/decision_outcomes.json
  Export available at:    .decisions/learning_export.json

INTEGRATION WITH NEXUS:

  NEXUS tools:                    NEXUS Learning:
  ┌─ nexus analyze        ──┐
  ├─ nexus advise         ──┼──→ nexus-learning record
  ├─ nexus decide         ──┘
  └─ nexus stats                 nexus-learning report

  Together they form a complete system:
  - Analyze your code
  - Make better decisions
  - Record what happens
  - Learn from experience
  - Improve over time

DOCUMENTATION:

  For detailed information, see:
  - decision-learning/README.md       (This module)
  - decision-synthesizer/README.md    (Decision synthesis)
  - Main README.md                    (Overview)

VERSION: 1.0.0
PAIRED WITH: NEXUS v1.3.0
LICENSE: MIT

Learn from your decisions. Build better systems.
"""
    print(help_text)


if __name__ == '__main__':
    main()
